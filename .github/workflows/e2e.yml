name: E2E Integration Test

on: 
  push:
  pull_request:


permissions:
  contents: read

jobs:
  build: 
    runs-on: ubuntu-latest
    
    steps:
      - name: Setup backend
        uses: actions/setup-python@v3
        with:
          python-version: "3.10"
        
      - name: Install dependencies
        run: |
            python -m pip install --upgrade pip
            pip install -r requirements.txt
        working-directory: /backend
      - name: Run server
        run: fastapi run
        working-directory: /backend

  cypress-run:
    needs: build
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Test
      uses: cypress-io/github-action@v6
      with:
        build: pnpm build
        start: pnpm test-run
        browser: chrome
        env: NEXT_PUBLIC_BACKEND_URL=http://localhost:8000
        spec: cypress/e2e/app.cy.ts
        working-directory: ./frontend
        wait-on: http://localhost:3000
        
          



